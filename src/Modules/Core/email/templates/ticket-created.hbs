<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{subject}}</title>
    <style>
        body { margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f8f9fa; color: #333; line-height: 1.6; }
        .email-container { max-width: 600px; margin: 0 auto; background-color: #ffffff; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        .header { background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); padding: 30px 20px; text-align: center; }
        .logo { max-width: 200px; height: auto; margin-bottom: 10px; }
        .company-name { color: white; font-size: 24px; font-weight: bold; margin: 0; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        .content { padding: 40px 30px; }
        .footer { background-color: #f8f9fa; padding: 20px 30px; text-align: center; border-top: 1px solid #e9ecef; }
        .footer-text { color: #6c757d; font-size: 12px; margin: 0; }
    </style>
</head>
<body>
    <div class="email-container">
        <div class="header">
            {{#if systemInfo.logoData}}
              <img src="{{systemInfo.logoData}}" alt="Charlotte Logo" class="logo" />
            {{else}}
              <img src="{{systemInfo.logoUrl}}" alt="Charlotte Logo" class="logo" />
            {{/if}}
            <h1 class="company-name">CHARLOTTE CHEMICAL</h1>
        </div>

        <div class="content">
          {{!-- si existe 'content' plano (p.ej. texto del mensaje), mostrarlo antes del layout detallado --}}
          {{#if content}}
            <div style="margin-bottom:16px;">{{{content}}}</div>
          {{/if}}

          <!-- Resumen r√°pido: informaci√≥n esencial + CTA -->
          <div style="background-color:#fff; border:1px solid #e9ecef; border-radius:8px; padding:16px; margin-bottom:20px;">
            <h4 style="margin:0 0 8px 0; color:#495057; font-size:16px;">Resumen r√°pido</h4>
            <p style="margin:0 0 8px 0; color:#6c757d; font-size:14px;">#{{ticket.ticketNumber}} ‚Ä¢ {{ticket.title}}</p>
            <p style="margin:0 0 12px 0; color:#6c757d; font-size:13px;">Estado: <strong style="color:{{ticket.statusColor}}">{{ticket.status}}</strong> ‚Äî Prioridad: <strong style="color:{{ticket.priorityColor}}">{{ticket.priority}}</strong></p>
            {{#if content}}
            <div style="background:#f8f9fa; padding:12px; border-radius:6px; margin-bottom:12px;">{{{content}}}</div>
            {{else}}
            {{#if ticket.description}}
            <div style="background:#f8f9fa; padding:12px; border-radius:6px; margin-bottom:12px;">{{breaklines ticket.description}}</div>
            {{/if}}
            {{/if}}
            <div style="text-align:center; margin-top:8px;">
              <a href="{{ticket.url}}" style="display:inline-block; background:#007bff; color:white; padding:10px 18px; border-radius:6px; text-decoration:none;">Ver caso</a>
            </div>
          </div>

          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 20px;">
            <div style="width: 48px; height: 48px; background-color: {{ticket.priorityColor}}; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 16px;">
              <span style="color: white; font-size: 24px; font-weight: bold;">üé´</span>
            </div>
            <div>
              <h2 style="margin: 0; color: #007bff; font-size: 24px; font-weight: 600;">{{#if isCopy}}CC: {{/if}}¬°Se ha creado un nuevo ticket!</h2>
              <p style="margin: 4px 0 0 0; color: #6c757d; font-size: 14px;">Ticket #{{ticket.ticketNumber}}</p>
              <p style="margin: 8px 0 0 0; color: #495057; font-size: 14px;">En Charlotte Chemical tratamos cada caso con enfoque estrat√©gico y rigor operativo; tu colaboraci√≥n y precisi√≥n en la informaci√≥n aceleran soluciones con impacto real en el negocio.</p>
            </div>
          </div>

          <!-- Informaci√≥n del ticket -->
          <div style="background-color: white; border-radius: 8px; border: 1px solid #e9ecef; margin-bottom: 24px; overflow: hidden;">
            <div style="background: linear-gradient(135deg, #007bff, #0056b3); padding: 24px; color: white;">
              <h1 style="margin: 0 0 8px 0; font-size: 20px; font-weight: 600;">{{ticket.title}}</h1>
              <div style="display: flex; gap: 16px; flex-wrap: wrap; align-items: center;">
                <span style="background-color: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 16px; font-size: 12px; font-weight: 500;">#{{ticket.ticketNumber}}</span>
                <span style="background-color: {{ticket.priorityColor}}; padding: 4px 12px; border-radius: 16px; font-size: 12px; font-weight: 500;">{{ticket.priority}}</span>
                <span style="background-color: {{ticket.statusColor}}; padding: 4px 12px; border-radius: 16px; font-size: 12px; font-weight: 500;">{{ticket.status}}</span>
              </div>
            </div>
            <div style="padding: 24px;">
              {{#if ticket.description}}
              <div style="margin-bottom: 20px;">
                <h3 style="margin: 0 0 8px 0; color: #495057; font-size: 16px; font-weight: 600;">Descripci√≥n:</h3>
                <div style="background-color: #f8f9fa; padding: 16px; border-radius: 6px; border-left: 4px solid #007bff;">{{breaklines ticket.description}}</div>
              </div>
              {{/if}}

              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 20px;">
                <div>
                  <strong style="color: #495057; font-size: 14px;">Creado por:</strong>
                  <p style="margin: 4px 0 0 0; color: #007bff;">{{ticket.createdBy.fullName}}</p>
                  <p style="margin: 0; color: #6c757d; font-size: 12px;">{{ticket.createdBy.email}}</p>
                </div>
                {{#if ticket.assignedTo}}
                <div>
                  <strong style="color: #495057; font-size: 14px;">Asignado a:</strong>
                  <p style="margin: 4px 0 0 0; color: #28a745;">{{ticket.assignedTo.fullName}}</p>
                  <p style="margin: 0; color: #6c757d; font-size: 12px;">{{ticket.assignedTo.email}}</p>
                </div>
                {{/if}}

                <div>
                  <strong style="color: #495057; font-size: 14px;">Tipo de ticket:</strong>
                  <p style="margin: 4px 0 0 0; color: #6f42c1;">{{ticket.ticketType.name}}</p>
                </div>

                <div>
                  <strong style="color: #495057; font-size: 14px;">Fecha de creaci√≥n:</strong>
                  <p style="margin: 4px 0 0 0; color: #6c757d;">{{ticket.formattedCreatedAt}}</p>
                </div>

                {{#if ticket.formattedDueDate}}
                <div>
                  <strong style="color: #495057; font-size: 14px;">Fecha l√≠mite:</strong>
                  <p style="margin: 4px 0 0 0; color: #fd7e14;">{{ticket.formattedDueDate}}</p>
                </div>
                {{/if}}

                {{#if ticket.department}}
                <div>
                  <strong style="color: #495057; font-size: 14px;">Departamento:</strong>
                  <p style="margin: 4px 0 0 0; color: #17a2b8;">{{ticket.department.name}}</p>
                </div>
                {{/if}}
              </div>

              {{#if ticket.hasAttachments}}
              <div style="margin-bottom: 20px;">
                <div style="display: flex; align-items: center; margin-bottom: 8px;">
                  <span style="font-size: 16px; margin-right: 8px;">üìé</span>
                  <strong style="color: #495057; font-size: 14px;">Archivos adjuntos ({{ticket.attachmentCount}}):</strong>
                </div>
                <div style="background-color: #f8f9fa; padding: 12px; border-radius: 6px;">
                  {{#each attachments}}
                  <div style="display: flex; align-items: center; padding: 8px 0; border-bottom: 1px solid #e9ecef;">
                    <span style="margin-right: 8px;">üìÑ</span>
                    <span style="color: #007bff; font-weight: 500;">{{this.filename}}</span>
                    <span style="margin-left: auto; color: #6c757d; font-size: 12px;">({{this.fileSize}})</span>
                  </div>
                  {{/each}}
                </div>
              </div>
              {{/if}}

              {{#if customMessage}}
              <div style="background-color: #e7f3ff; border: 1px solid #b3d9ff; border-radius: 6px; padding: 16px; margin-bottom: 20px;">
                <h4 style="margin: 0 0 8px 0; color: #0056b3; font-size: 14px;">Mensaje adicional:</h4>
                <p style="margin: 0; color: #495057;">{{breaklines customMessage}}</p>
              </div>
              {{/if}}
            </div>
          </div>

          <!-- Bot√≥n de acci√≥n principal -->
          <div style="text-align: center; margin: 32px 0;">
            <a href="{{ticket.url}}" style="display: inline-block; background: linear-gradient(135deg, #007bff, #0056b3); color: white; text-decoration: none; padding: 16px 32px; border-radius: 8px; font-weight: 600; font-size: 16px; box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3); transition: all 0.2s;">üîç Ver Ticket en el Sistema</a>
          </div>

          {{#unless isCopy}}
          <div style="background-color: #f8f9fa; border-radius: 8px; padding: 20px; border-left: 4px solid #28a745;">
            <h3 style="margin: 0 0 12px 0; color: #155724; font-size: 16px;">¬øQu√© sigue?</h3>
            <ul style="margin: 0; padding-left: 20px; color: #495057;">
              <li style="margin-bottom: 8px;">Revisa los detalles del ticket haciendo clic en el enlace anterior</li>
              <li style="margin-bottom: 8px;">{{#if ticket.assignedTo}}El agente asignado se pondr√° en contacto contigo pronto{{else}}El ticket ser√° asignado a un agente especializado{{/if}}</li>
              <li style="margin-bottom: 8px;">Recibir√°s notificaciones autom√°ticas sobre cualquier actualizaci√≥n</li>
              <li>Puedes agregar comentarios o informaci√≥n adicional desde el sistema</li>
            </ul>
          </div>
          {{/unless}}

          <!-- Encuesta de satisfacci√≥n breve y profesional -->
          <div style="background-color: #f5f7fb; border: 1px solid #e3e8ef; border-radius: 10px; padding: 18px; margin-top: 18px; text-align: center;">
            <h4 style="margin: 0 0 8px 0; color: #232f3e; font-size: 15px;">Tu opini√≥n impulsa nuestras decisiones</h4>
            <p style="margin: 0 0 12px 0; color: #495057; font-size: 13px; line-height:1.4;">Ded√≠canos 60 segundos para decirnos c√≥mo fue tu experiencia. Tus comentarios orientan nuestras mejoras estrat√©gicas.</p>
            <a href="{{systemInfo.frontendUrl}}/feedback/{{ticket.id}}" style="display:inline-block; background: linear-gradient(135deg,#232f3e,#0b1620); color: #fff; padding: 10px 16px; border-radius: 6px; text-decoration:none; font-weight:600;">Completar encuesta (60s)</a>
          </div>
        </div>

        <div class="footer">
            <p class="footer-text">Este es un correo autom√°tico generado por el sistema Charlotte Chemical.<br>Por favor, no responder a este mensaje.<br>¬© {{systemInfo.year}} Charlotte Chemical Internacional, S.A. de C.V. Todos los derechos reservados.</p>
        </div>
    </div>
</body>
</html>
